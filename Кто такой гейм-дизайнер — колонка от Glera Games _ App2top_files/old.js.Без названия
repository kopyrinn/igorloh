var A2tApp=function(r){var s=this;this.userCompaniesCount=r(".profile .companies__item").length,this.userCompaniesLimit=3,this.modalMsg="",this.themePath=themePath,this.sending=!1,this.appInit=function(){this.backgroundClickInit(),this.searchFormsInit(),this.mobileMenuInit(),this.previewCommentInit(),this.clipboardsInit(),this.jobEditInit(),this.newCompanyRegistr(),this.tabsInit(),this.textareaResizeInit(),this.uploadCompanyLogoInit(),this.editCompanyInit(),this.editCareerInit(),this.translateCompanyInit(),this.removeVacancy(),this.removeCompanyInit(),this.deleteCareerInit(),this.showTextErrorInit(),this.sendTextErrorInit(),this.vacanciesSearchInit(),this.popularListInit()},this.elemActionInit=function(t,e,i){if(!t.length)return!1;t.each(function(t,n){r(n).on(e,function(){i(r(n))})})},this.ajaxAction=function(t){var n=null;return r.ajax({async:!1,global:!0,url:ajaxurl,dataType:"json",data:t,type:"POST",error:function(){console.log("Ошибка при выполнении запроса 1")},cache:!1,success:function(t){if(!t)return console.log("Ошибка при выполнении запроса 2"),!1;n=t}}),n},this.showAlert=function(t){var n=new tingle.modal({footer:!1,onClose:function(){}});n.setContent(t),n.open()},this.backgroundClickInit=function(){var t=r(".bg_top_image, #mobile-banner");this.elemActionInit(t,"click",function(){window.open(topUrl,"_blank")})},this.stickyMenuInit=function(){var n,e=r(".top_menu");e.length&&(n=e.height(),r(window).on("scroll",function(t){t(this).scrollTop()>=n?e.addClass("sticky"):e.removeClass("sticky"),300<t(this).scrollTop()?t(".to_top").fadeIn():t(".to_top").fadeOut()}))},this.searchFormsInit=function(){var t=r(".search");this.elemActionInit(t,"click",function(t){var n=r(t).attr("data-form-id"),e=r("#"+n),i=e.find(".form__search"),a=e.find(".form__buttons-search"),o=e.find(".form__buttons-close"),n=r(t).parents(".menu__nav").find("ul").children("li:visible").length+1,s=r(t).parent(".menu__nav").find("ul").find("li").eq(n);e.animate({width:"show"},500),i.focus(),setTimeout(function(){s.css("opacity","0")},600),a.click(function(){return i.val().length<2?alert("Введите поисковую фразу!"):r(this).parents("form").submit(),!1}),o.click(function(){setTimeout(function(){e.animate({width:"hide"},500),setTimeout(function(){s.css("opacity","1")},510)},100)})})},this.mobileMenuInit=function(){var t="hide",n=r(".mobile-button");n.length&&n.on("click",function(){t="hide"===t?(r(".menu__mobile").slideDown(400),"show"):(r(".menu__mobile").slideUp(400),"hide")})},this.previewCommentInit=function(){var t=r(".preview-add-comment");this.elemActionInit(t,"click",function(t){var n=t.attr("data-rel-id"),e=r(t).parents(".preview").find(".preview__comments"),i=e.find("textarea");r(t).hide(),i.val(""),e.show(),setTimeout(function(){i.css("width","100%").focus();var t=e.find(".add_comment");s.elemActionInit(t,"click",function(){var t=i.val();if(t.length<2)return alert("Введите текст комментария!"),!1;s.addComment(n,t,"preview",0)})},100)})},this.clipboardsInit=function(){r(".clipboard").length&&new Clipboard(".clipboard").on("success",function(t){s.modalMsg="<p>Ссылка скопирована в буфер обмена. Чтобы вставить ссылку нажмите клавиши ctrl + v.</p>",s.showAlert(s.modalMsg)})},this.sendPostComment=function(t){var n;this.sending||(0===(n=r("#comment-text-"+t).val()).length?alert("Введите текст комментария!"):s.addComment(t,n,"post",0))},this.openCommentAnswer=function(t,n){var e=r("#comment-"+n),i=r("#comment-answer-"+t),a=i.find("textarea"),t=e.data("author");i.find("img").attr("src",userPhoto),a.val(t+", "),i.find("[name = pcomment-id]").val(n),i.show(),e.after(i)},this.sendAnswerComment=function(t){var n=r("#comment-answer-"+t),e=n.find("textarea").val(),i=n.find("[name = pcomment-id]").val();s.addComment(t,e,"post",i)&&n.hide()},this.addComment=function(t,n,e,i){if(!this.sending){this.sending=!0,console.log("comment"),n=n.replace(/\r?\n/g,"<br />");var a={action:"add_comment",post_id:t,user_id:user_id,parent:i,text:n,sf_5150:sf_5150},o=this.ajaxAction(a);return this.sending=!1,!(!o||200!==o.status)&&("preview"===e?((e=(a=r("[data-post-id = "+t+"]").find(".preview__comments_item:last-child")).clone()).find(".form").html("<p>"+n+"</p>"),a.after(e).hide()):(t=r("#post-"+t),0===i?t.find(".comments__list").append(o.comment_html):r("#comment-"+i).after(o.comment_html),t.find(".comment_text").val("")),!0)}},this.sendCommentRating=function(t,n){var e=r("#comment-"+t),t={action:"add_rating",comment_id:t,rating:n,user_id:user_id,sf_5150:sf_5150},n=s.ajaxAction(t);200===n.status&&(e=(t=e.find(".rating__score")).attr("class"),t.removeClass(e).html(n.rating).addClass("rating__score").addClass(n.r_class))},this.jobEditInit=function(){var t=r(".job_info_link"),n=r(".job_info_edit-btn"),i=r(".job_info_edit"),a=r(".job_info");this.elemActionInit(t,"click",function(t){a.hide(),i.show()}),this.elemActionInit(n,"click",function(t){var n=r("#job_info_edit_input").val();if(n===userJobText)return i.hide(),a.show(),!1;var e={action:"add_user_job",text:n,user_id:user_id,sf_5150:sf_5150},e=s.ajaxAction(e);e.status,i.hide(),n.length?a.children("span").text(e.text):a.children("span").text("Должность не указана"),a.show(),userJobText=e.text})},this.deleteCareerInit=function(){var t=r(".career-delete-link");this.elemActionInit(t,"click",function(t){var n=r(t).parents(".career__item"),t={action:"delete_career",cr_id:n.attr("data-career"),user_id:user_id,sf_5150:sf_5150};800===s.ajaxAction(t).status&&n.remove()})},this.newCompanyRegistr=function(){var t=r("#new-company-btn");r(".companies");this.elemActionInit(t,"click",function(t){s.modalMsg='<div class="popup-content">',s.modalMsg+='<p class="popup-title">Введите название комапнии</p>',s.modalMsg+='<p><input type="text" placeholder="Название компании" id="new-company-name" /></p>',s.modalMsg+='<p><a class="btn btn-profile btn-profile-5" id="send_application">Отправить заявку</a></p>',s.modalMsg+="</div>",s.modalMsg+='<p class="send-status"></p>',s.showAlert(s.modalMsg);var n=r("#send_application");s.elemActionInit(n,"click",function(t){var n=r("#new-company-name"),e=n.val(),i=r(".send-status"),a=(r(".profile__companies"),r(".add_item"));if(e.length<2)return i.text("В названии компании должно быть не менее 2 букв"),!1;var o={action:"add_new_company",user_id:user_id,sf_5150:sf_5150,name:e},o=s.ajaxAction(o);if(401==o.status||402==o.status)return!1;o='<div class="profile__item"><div class="profile__item_left"><img src="'+s.themePath+'/build/img/company-default-logo.png" class="img-responsive"/></div>';o+='<div class="profile__item_right"><h3 class="profile__name">'+e+"</h3>",o+='<p class="profile__info" id="show-company-profile"><span class="consideration">Заявка на рассмотрении</span></p>',a.before(o+="</div></div>"),n.val(""),s.userCompaniesCount++,s.userCompaniesCount===s.userCompaniesLimit&&a.remove(),r(".popup-content").remove(),i.html('Ваша заявка отправлена!<i class="icon-check"></i>')})})},this.editCompanyInit=function(){var t=r("#btn-form-edit");this.elemActionInit(t,"click",function(t){s.validateForm()})},this.editCareerInit=function(){var t=r("#career-edit-btn");this.elemActionInit(t,"click",function(t){s.validateForm()})},this.validateForm=function(){var e=!0,i="",t=r(".verification"),n=r("#form-image"),a=r(".form_error");a.html(""),t.find("[data-required = true]").each(function(t,n){3<r(n).val().length?r(n).removeClass("empty").addClass("no_empty"):(r(n).removeClass("no_empty").addClass("empty"),e=!(i="Поля, отмеченные звездочкой, необходимо заполнить! <br>"))}),n.length&&0===n.val().length&&(i+="Не выбрано изображение логотипа! <br>",e=!1),t.find("select").each(function(t,n){r(n).addClass("empty"),"0"===r(n).val()?(i+="Не выбран вариант следующего поля: "+r(n).children("option").filter(":first").text()+"! <br>",e=!1):r(n).removeClass("empty")}),e||a.html(i),e&&t.submit()},this.removeCompanyInit=function(){var t=r(".remove-company");this.elemActionInit(t,"click",function(t){var n=r(t).parents(".companies__item"),t={action:"remove_company",cmp_id:n.attr("data-company"),user_id:user_id,string:sf_5150};if(600!==s.ajaxAction(t).status)return!1;n.remove(),s.userCompaniesCount--,s.userCompaniesCount<s.userCompaniesLimit&&r(".add_item").show()})},this.removeVacancy=function(){var t=r(".remove-vacancy");this.elemActionInit(t,"click",function(t){var n=r(t).parents(".pagelist__item"),t={action:"remove_vacancy",vacancy_id:n.attr("data-vacancy"),user_id:user_id,string:sf_5150};if(900!==s.ajaxAction(t).status)return!1;n.remove()})},this.translateCompanyInit=function(){var t=r(".translate-company");this.elemActionInit(t,"click",function(t){var a=r(t).attr("data-company-id");r(this).attr("rel"),r(this).parent(".item").children("h3").text();s.modalMsg="<p>Введите адрес аккаунта пользователя на который хотите перевести компанию</p>",s.modalMsg+='<p><input type="text" placeholder="Например: http://vk.com/XXXXX" id="translate-account" /></p>',s.modalMsg+='<p><a class="btn btn-profile btn-profile-5" id="translate-link">Перевести</a></p>',s.modalMsg+='<p class="translate-status"></p>',s.showAlert(s.modalMsg);t=r("#translate-link");s.elemActionInit(t,"click",function(t){var n=r("#translate-account").val(),e=r(t).attr("data-action-rel"),i=r(".translate-status");i.text("");n={action:"translate_company",cmp_id:a,user_id:user_id,translate_user:n,sf_5150:sf_5150},n=s.ajaxAction(n);700===n.status?(i.text(n.text),"user-translate"===e?setTimeout(function(){document.location.href="/account/"},2e3):(r(t).hide(),r("[data-company = "+a+"]").remove(),s.userCompaniesCount--,s.userCompaniesCount<s.userCompaniesLimit&&r(".add_item").show())):i.text(n.text)})})},this.tabsInit=function(){var e=r(".tabs__items a");this.elemActionInit(e,"click",function(t){var n=r(t).attr("data-tab-id");e.each(function(t,n){r(n).removeClass("current")}),r(t).addClass("current"),r(".tabs__area").each(function(t,n){r(n).hide()}),r("#"+n).show()})},this.textareaResizeInit=function(){autosize(r("textarea"))},this.uploadCompanyLogoInit=function(){var t=r("#upload_logo"),e=r("#company-logo"),i=r(".preloader");t.length&&new AjaxUpload(t,{action:actionUrl,name:"uploadfile",data:companyData,onSubmit:function(t,n){if(!n||!/^(jpg|png|jpeg|gif)$/.test(n))return s.modalMsg="<p>Недопустимое раширение файла!</p>",s.showAlert(s.modalMsg),!1;e.hide(),i.show()},responseType:"json",onComplete:function(t,n){return"alert"===n.status?s.showAlert(n.msg):"error"===n.status?(s.modalMsg="Ошибка при загрузке файла!",s.showAlert(s.modalMsg)):(e.attr("src",n.link),r("#form-image").val(n.link)),setTimeout(function(){i.hide(),e.show()},1e3),!1}})},this.showTextErrorInit=function(){var n="hide",t=r("#send-error-link"),e=r(".text_error");this.elemActionInit(t,"click",function(t){return n="hide"===n?(e.show(500),r(t).html('<i class="icon-cross-mark"></i>'),"show"):(e.hide(500),r(t).html("Сообщить"),"hide"),!1})},this.sendTextErrorInit=function(){var t=r(".text_error__btn");this.elemActionInit(t,"click",function(t){var n=r("#error__text").val();n.length<3?(s.modalMsg="<p>Введите текст сообщения!</p>",s.showAlert(s.modalMsg)):(n=n.replace(/\r?\n/g,"<br />"),n={action:"send_text_error",post_id:post_id,text:n,user_id:user_id,sf_5150:sf_5150},900===s.ajaxAction(n).status?(r(".send_error").html("<strong>Сообщение отправлено!</strong>"),r(t).parents(".text_error").hide()):(s.modalMsg="Ошибка при отправке сообщения!",s.showAlert(s.modalMsg)))})},this.vacanciesSearchInit=function(){var i,a,o=r(".vacancies__search_checkboxes").find('input[type="checkbox"]'),n=r("#search-by-company");this.elemActionInit(o,"change",function(t){n.trigger("click")}),this.elemActionInit(n,"click",function(t){var e,n;a=r('[name="company"]').val(),e="",r(o).each(function(t,n){r(n).prop("checked")&&(e+=r(n).val(),e+=",")}).promise().done(function(){e.substring(0,e.length-1)}),i=e,0===a.length&&0===i.length?window.location.reload(!1):(a.length<3&&(a=!1),n={action:"vacancy_by_category",category:i=i.length<1?!1:i,company:a},void 0!==(n=s.ajaxAction(n)).html&&null!==n.html&&r(".vacancies__items").html(n.html),r(".pagination").hide())})},this.popularListInit=function(){var t=r("#popular-list-link"),n=r("#popular-list"),e="hidden";this.elemActionInit(t,"click",function(t){"hidden"===e?(n.show(100),e="vivsible",r(t).addClass("active")):(n.hide(100),e="hidden",r(t).removeClass("active"))})}},a2tApp=new A2tApp($);$(document).ready(function(){a2tApp.appInit()});